# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–µ–ø–ª–æ—è ContentForce –Ω–∞ Coolify

## üìã –ö—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞

### 1Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (5 –º–∏–Ω—É—Ç)

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SECRET_KEY_BASE
cd /Users/avdemkin/Documents/–¥–æ–∫—É–º–µ–Ω—Ç—ã/CONTtg/contentforce
bundle exec rails secret

# –ó–∞–ø–æ–º–Ω–∏—Ç–µ:
# RAILS_MASTER_KEY: 995a2f3b6ea26667605e7b925ed0b195
# SECRET_KEY_BASE: <—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ>
```

### 2Ô∏è‚É£ –í Coolify: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (5 –º–∏–Ω—É—Ç)

**PostgreSQL 16:**
1. Add Resource ‚Üí Database ‚Üí PostgreSQL 16
2. Name: `contentforce-db`
3. Start service
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ DATABASE_URL** ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–ª–æ–∫–Ω–æ—Ç

**Redis 7 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
1. Add Resource ‚Üí Database ‚Üí Redis 7
2. Name: `contentforce-redis`
3. Start service
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ REDIS_URL** ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–ª–æ–∫–Ω–æ—Ç

### 3Ô∏è‚É£ –í Coolify: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (3 –º–∏–Ω—É—Ç—ã)

1. Add Resource ‚Üí Application
2. Source: **GitHub**
3. Repository: –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ContentForce
4. Branch: **main**
5. Build Pack: **Dockerfile**

### 4Ô∏è‚É£ –í Coolify: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (5 –º–∏–Ω—É—Ç)

**‚ö†Ô∏è –í–°–ï –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ "Runtime Only"!**

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Environment Variables:

```bash
# === Database & Redis ===
DATABASE_URL=postgresql://postgres:–ü–ê–†–û–õ–¨@postgres-xxxx:5432/postgres
# ‚òùÔ∏è –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à URL

REDIS_URL=redis://redis-xxxx:6379/0
# ‚òùÔ∏è –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à URL (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)

# === Rails ===
RAILS_ENV=production
RAILS_MAX_THREADS=5
WEB_CONCURRENCY=2
RAILS_SERVE_STATIC_FILES=true
RAILS_LOG_TO_STDOUT=true

# === Security ===
RAILS_MASTER_KEY=995a2f3b6ea26667605e7b925ed0b195
SECRET_KEY_BASE=–í–ê–®_–°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–´–ô_–ö–õ–Æ–ß

# === Telegram ===
TELEGRAM_BOT_TOKEN=7608089982:AAGx-Z4oG6qVIbqlva2Wwbt39nqNSZAi4YU
TELEGRAM_BOT_USERNAME=–≤–∞—à_–±–æ—Ç_username
TELEGRAM_ORIGIN_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com

# === OpenRouter ===
OPENROUTER_API_KEY=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
OPENROUTER_API_URL=https://openrouter.ai/api/v1
OPENROUTER_SITE_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com
OPENROUTER_SITE_NAME=ContentForce
```

### 5Ô∏è‚É£ –í Coolify: –ü–æ—Ä—Ç—ã –∏ –¥–æ–º–µ–Ω (2 –º–∏–Ω—É—Ç—ã)

**Ports:**
- Container Port: `3000`
- Public Port: `80` –∏–ª–∏ `443`

**Domains:**
- –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω
- –í–∫–ª—é—á–∏—Ç–µ SSL (Let's Encrypt)

### 6Ô∏è‚É£ –î–µ–ø–ª–æ–π (5-10 –º–∏–Ω—É—Ç)

1. –ù–∞–∂–º–∏—Ç–µ **"Deploy"**
2. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏
3. –î–æ–∂–¥–∏—Ç–µ—Å—å "Build successful"

### 7Ô∏è‚É£ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è (3 –º–∏–Ω—É—Ç—ã)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
https://–≤–∞—à-–¥–æ–º–µ–Ω.com
https://–≤–∞—à-–¥–æ–º–µ–Ω.com/up  # –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å "OK"
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Webhook:**
```bash
# –í Coolify ‚Üí Application ‚Üí Terminal:
./bin/rails console

# –í –∫–æ–Ω—Å–æ–ª–∏ Rails:
bot = Telegram::Bot::Client.new(ENV['TELEGRAM_BOT_TOKEN'])
bot.set_webhook(url: "#{ENV['TELEGRAM_ORIGIN_URL']}/telegram/webhook")
exit
```

---

## ‚ö° –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

### –í Coolify Terminal

```bash
# –ö–æ–Ω—Å–æ–ª—å Rails
./bin/rails console

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
./bin/rails db:migrate

# –°—Ç–∞—Ç—É—Å –ë–î
./bin/rails db:version

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
./bin/rails console
# User.create!(email: 'test@test.com', password: 'password123')

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å jobs
./bin/rails solid_queue:status

# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à
./bin/rails cache:clear

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
env | grep RAILS
env | grep TELEGRAM
```

---

## üîß –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "Database connection error"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. PostgreSQL —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –≤ Coolify
2. DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
3. DATABASE_URL –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ "Runtime Only"

# –í Terminal:
echo $DATABASE_URL  # –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å URL
./bin/rails db:version  # –¥–æ–ª–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
```

### –û—à–∏–±–∫–∞: "Assets not found"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
echo $RAILS_SERVE_STATIC_FILES  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "true"

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ:
# –í Coolify ‚Üí Redeploy
```

### –û—à–∏–±–∫–∞: "Redis connection refused"
```bash
# –ï—Å–ª–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Redis –≤ –∫–æ–¥–µ:
# –ú–æ–∂–µ—Ç–µ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å Redis —Å–µ—Ä–≤–∏—Å –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å REDIS_URL

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Redis:
1. Redis —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
2. REDIS_URL –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
```

### Telegram Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
echo $TELEGRAM_ORIGIN_URL  # –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å https://–≤–∞—à-–¥–æ–º–µ–Ω.com

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook:
./bin/rails console
bot = Telegram::Bot::Client.new(ENV['TELEGRAM_BOT_TOKEN'])
info = bot.get_webhook_info
puts info

# 3. –£–¥–∞–ª–∏—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:
bot.delete_webhook
bot.set_webhook(url: "#{ENV['TELEGRAM_ORIGIN_URL']}/telegram/webhook")
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –≤ Coolify
```
Application ‚Üí Logs ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø:
- Build Logs (–ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏)
- Application Logs (–ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- PostgreSQL Logs (–ª–æ–≥–∏ –ë–î)
```

### –ú–µ—Ç—Ä–∏–∫–∏
```
Application ‚Üí Metrics:
- CPU Usage
- Memory Usage
- Disk Usage
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# 1. –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
cd /Users/avdemkin/Documents/–¥–æ–∫—É–º–µ–Ω—Ç—ã/CONTtg/contentforce
git add .
git commit -m "Update"
git push origin main

# 2. –í Coolify:
# Application ‚Üí Redeploy (–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ auto-deploy —á–µ—Ä–µ–∑ Webhook)
```

---

## üíæ –ë—ç–∫–∞–ø—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤ –ë–î

1. Coolify ‚Üí PostgreSQL —Å–µ—Ä–≤–∏—Å ‚Üí **Backups**
2. –í–∫–ª—é—á–∏—Ç–µ "Enable automatic backups"
3. Frequency: **Daily** (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
4. Retention: **7 days** (7 –¥–Ω–µ–π)

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø

```bash
# –í PostgreSQL Terminal:
pg_dump -U postgres postgres > backup_$(date +%Y%m%d).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
psql -U postgres postgres < backup_20260112.sql
```

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

```
‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:
[ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω SECRET_KEY_BASE
[ ] PostgreSQL —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø—É—â–µ–Ω
[ ] DATABASE_URL —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
[ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã
[ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—á–µ–Ω—ã "Runtime Only"
[ ] –ü–æ—Ä—Ç 3000 –Ω–∞—Å—Ç—Ä–æ–µ–Ω
[ ] –î–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
[ ] SSL –≤–∫–ª—é—á–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
[ ] –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ Deploy

‚úÖ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
[ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
[ ] /up endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "OK"
[ ] Telegram webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω
[ ] –ë—ç–∫–∞–ø—ã –ë–î –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
[ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—à–∏–±–∫–∏
```

---

## üéØ –ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è

- **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:** 5 –º–∏–Ω—É—Ç
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Coolify:** 15 –º–∏–Ω—É—Ç
- **–î–µ–ø–ª–æ–π:** 5-10 –º–∏–Ω—É—Ç
- **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:** 3 –º–∏–Ω—É—Ç—ã

**–í—Å–µ–≥–æ:** ~30 –º–∏–Ω—É—Ç (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)

–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–ø–ª–æ–∏: **2-5 –º–∏–Ω—É—Ç** (—Ç–æ–ª—å–∫–æ Redeploy)

---

## üìû –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–î–ï–ü–õ–û–Ø.md`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `–ü–†–û–í–ï–†–ö–ê_–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò.md`
- **Coolify Docs:** https://coolify.io/docs
- **Rails Deployment Guide:** https://guides.rubyonrails.org/deployment

---

**–ì–æ—Ç–æ–≤–æ! –°–ª–µ–¥—É–π—Ç–µ —à–∞–≥–∞–º –∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! üöÄ**
