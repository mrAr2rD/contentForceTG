<div class="max-w-2xl mx-auto px-8 py-8">
  <!-- Header -->
  <div class="mb-6">
    <%= link_to project_path(@project), class: "inline-flex items-center gap-2 text-xs text-muted-foreground hover:text-foreground mb-3 transition-colors" do %>
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
      </svg>
      Назад к проекту
    <% end %>
    <h1 class="text-xl font-semibold text-foreground">Редактировать проект</h1>
    <p class="text-xs text-muted-foreground mt-1"><%= @project.name %></p>
  </div>

  <!-- Form -->
  <div class="bg-card border border-border rounded-lg">
    <%= form_with model: @project, local: true, class: "p-6 space-y-5" do |f| %>
      <% if @project.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-md p-3">
          <div class="flex items-start gap-2">
            <svg class="w-4 h-4 text-red-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
            </svg>
            <div>
              <h3 class="text-xs font-medium text-red-800 mb-1">Ошибки при сохранении</h3>
              <ul class="text-xs text-red-700 space-y-0.5">
                <% @project.errors.full_messages.each do |error| %>
                  <li>• <%= error %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>

      <div class="space-y-2">
        <%= f.label :name, "Название проекта", class: "text-sm font-medium text-foreground" %>
        <%= f.text_field :name, class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
      </div>

      <div class="space-y-2">
        <%= f.label :description, "Описание", class: "text-sm font-medium text-foreground" %>
        <%= f.text_area :description, rows: 4, class: "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
      </div>

      <div class="space-y-2">
        <%= f.label :status, "Статус", class: "text-sm font-medium text-foreground" %>
        <%= f.select :status, [["Черновик", "draft"], ["Активный", "active"], ["Архив", "archived"]], {}, class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
      </div>

      <!-- AI Settings Section -->
      <div class="pt-4 border-t border-border">
        <h3 class="text-sm font-semibold text-foreground mb-4 flex items-center gap-2">
          <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          Настройки AI
        </h3>

        <div class="space-y-4">
          <!-- AI Model -->
          <div class="space-y-2">
            <%= f.label :ai_model, "Модель AI", class: "text-sm font-medium text-foreground" %>
            <%= f.select :ai_model,
                options_for_select(Project::AI_MODELS.map { |k, v| [v, k] }, @project.ai_model),
                { include_blank: "Не выбрано (использовать глобальные настройки)" },
                class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
            <p class="text-xs text-muted-foreground">Модель, которая будет использоваться для генерации контента</p>
          </div>

          <!-- AI Temperature -->
          <div class="space-y-2">
            <%= f.label :ai_temperature, "Креативность (Temperature)", class: "text-sm font-medium text-foreground" %>
            <%= f.number_field :ai_temperature,
                step: 0.1,
                min: 0,
                max: 2,
                class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
            <p class="text-xs text-muted-foreground">0 = более предсказуемо, 2 = более креативно (рекомендуется 0.7)</p>
          </div>

          <!-- Writing Style -->
          <div class="space-y-2">
            <%= f.label :writing_style, "Стиль написания", class: "text-sm font-medium text-foreground" %>
            <%= f.select :writing_style,
                options_for_select(Project::WRITING_STYLES.map { |k, v| [v, k] }, @project.writing_style),
                { include_blank: "Не выбрано (использовать стандартный)" },
                class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
            <p class="text-xs text-muted-foreground">Выберите стиль, который AI будет использовать при генерации</p>
          </div>

          <!-- System Prompt -->
          <div class="space-y-2">
            <%= f.label :system_prompt, "Системный промпт (необязательно)", class: "text-sm font-medium text-foreground" %>
            <%= f.text_area :system_prompt,
                rows: 4,
                placeholder: "Например: Ты эксперт в области технологий. Пиши посты для IT-аудитории с техническими деталями...",
                class: "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
            <p class="text-xs text-muted-foreground">Кастомная инструкция для AI. Если не указан, будет использован стандартный промпт на основе выбранного стиля</p>
          </div>

          <!-- Custom Style -->
          <% if @project.style_style_completed? %>
            <div class="space-y-3 p-4 rounded-lg border border-primary/20 bg-primary/5">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center">
                  <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                </div>
                <div class="flex-1">
                  <div class="flex items-center justify-between">
                    <h4 class="text-sm font-medium text-foreground">Пользовательский стиль</h4>
                    <span class="text-xs text-primary bg-primary/10 px-2 py-0.5 rounded-full">Готов</span>
                  </div>
                  <p class="text-xs text-muted-foreground mt-1">
                    Стиль проанализирован на основе <%= @project.style_samples_count %> примеров
                    (<%= @project.total_style_words %> слов)
                  </p>
                </div>
              </div>

              <label class="flex items-center gap-3 cursor-pointer">
                <%= f.check_box :custom_style_enabled, class: "w-4 h-4 rounded border-input text-primary focus:ring-primary" %>
                <span class="text-sm text-foreground">Использовать пользовательский стиль при генерации</span>
              </label>

              <% if @project.custom_style_enabled && @project.custom_style_prompt.present? %>
                <details class="text-xs">
                  <summary class="text-muted-foreground cursor-pointer hover:text-foreground">Показать промпт стиля</summary>
                  <div class="mt-2 p-3 bg-background rounded border border-border text-muted-foreground whitespace-pre-wrap max-h-40 overflow-y-auto">
                    <%= @project.custom_style_prompt.truncate(500) %>
                  </div>
                </details>
              <% end %>
            </div>
          <% elsif @project.has_style_data? %>
            <div class="p-4 rounded-lg border border-border bg-muted/30">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-muted flex items-center justify-center">
                  <svg class="w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <div class="flex-1">
                  <h4 class="text-sm font-medium text-foreground">Пользовательский стиль</h4>
                  <p class="text-xs text-muted-foreground mt-1">
                    <%= @project.style_samples_count %> примеров загружено.
                    <% if @project.style_style_analyzing? %>
                      <span class="text-primary">Анализ в процессе...</span>
                    <% else %>
                      Запустите анализ стиля для активации.
                    <% end %>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <div class="pt-4 flex items-center gap-3 border-t border-border">
        <%= f.submit "Сохранить изменения", class: "inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" %>
        <%= link_to "Отмена", project_path(@project), class: "inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" %>
      </div>
    <% end %>
  </div>
</div>
