<div class="max-w-6xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <nav class="text-sm text-gray-500 dark:text-gray-400 mb-2">
        <%= link_to "Проекты", projects_path, class: "hover:text-gray-700 dark:hover:text-gray-300" %> /
        <%= link_to @project.name, project_path(@project), class: "hover:text-gray-700 dark:hover:text-gray-300" %> /
        Настройки стиля
      </nav>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Настройки стиля</h1>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left Column (2/3) -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Import from Telegram -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Импорт из Telegram</h2>

        <% if @telegram_sessions.any? %>
          <%= form_with url: import_from_telegram_project_style_samples_path(@project), method: :post, data: { turbo_frame: "_top" } do |f| %>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Сессия</label>
                <%= f.select :telegram_session_id, @telegram_sessions.map { |s| [s.masked_phone, s.id] }, {}, class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white" %>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Username канала</label>
                <%= f.text_field :channel_username, placeholder: "@channel", class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white" %>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Лимит постов</label>
                <%= f.select :limit, [[100, 100], [500, 500], [1000, 1000]], {}, class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white" %>
              </div>
            </div>
            <div class="mt-4">
              <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                Импортировать посты
              </button>
            </div>
          <% end %>
          <div id="import_status" class="mt-4"></div>
        <% else %>
          <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Для импорта постов необходимо
              <%= link_to "авторизовать Telegram аккаунт", new_telegram_session_path, class: "text-blue-600 hover:text-blue-700 dark:text-blue-400" %>
            </p>
          </div>
        <% end %>
      </div>

      <!-- Upload Documents -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Загрузка документов</h2>

        <%= form_with url: project_style_documents_path(@project), method: :post, multipart: true, data: { controller: "file-upload", turbo_frame: "_top" } do |f| %>
          <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center"
               data-file-upload-target="dropzone"
               data-action="dragover->file-upload#dragover dragenter->file-upload#dragenter dragleave->file-upload#dragleave drop->file-upload#drop">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            <div class="mt-4">
              <label class="cursor-pointer">
                <span class="text-blue-600 hover:text-blue-700 dark:text-blue-400">Выберите файл</span>
                <span class="text-gray-500 dark:text-gray-400"> или перетащите сюда</span>
                <%= f.file_field :file, accept: ".txt,.md,.markdown", class: "hidden", data: { file_upload_target: "input", action: "change->file-upload#fileSelected" } %>
              </label>
            </div>
            <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">.txt, .md до 1 MB</p>
          </div>
          <div id="upload_status" class="mt-4" data-file-upload-target="status"></div>
        <% end %>

        <!-- Documents List -->
        <% if @style_documents.any? %>
          <div class="mt-6">
            <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Загруженные документы</h3>
            <ul id="style_documents_list" class="space-y-2">
              <% @style_documents.each do |document| %>
                <%= render "projects/style_documents/document", document: document %>
              <% end %>
            </ul>
          </div>
        <% end %>
      </div>

      <!-- Manual Samples -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Примеры стиля</h2>

        <div id="new_sample_form">
          <%= render "projects/style_samples/form", project: @project %>
        </div>

        <% if @style_samples.any? %>
          <div class="mt-6">
            <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
              Добавленные примеры (<%= @style_samples.count %>)
            </h3>
            <ul id="style_samples_list" class="space-y-3 max-h-96 overflow-y-auto">
              <% @style_samples.each do |sample| %>
                <%= render "projects/style_samples/sample", sample: sample %>
              <% end %>
            </ul>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Right Column (1/3) -->
    <div class="space-y-6">
      <!-- Stats -->
      <div id="style_stats">
        <%= render "projects/style_settings/stats", project: @project %>
      </div>

      <!-- Status & Actions -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Анализ стиля</h3>

        <div id="style_status">
          <%= render "projects/style_settings/status", project: @project %>
        </div>
      </div>

      <!-- Style Preview -->
      <% if @project.custom_style_prompt.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Описание стиля</h3>
          <div class="prose prose-sm dark:prose-invert max-h-96 overflow-y-auto">
            <%= simple_format(@project.custom_style_prompt.truncate(1000)) %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
