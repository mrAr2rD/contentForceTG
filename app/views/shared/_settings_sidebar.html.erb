<aside class="w-64 flex-shrink-0 hidden lg:block">
  <nav class="space-y-1 sticky top-8">
    <!-- Profile Section -->
    <div class="px-3 py-2">
      <p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2">
        Аккаунт
      </p>
    </div>

    <%= link_to subscriptions_path, class: "flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors #{current_page?(subscriptions_path) ? 'bg-primary/10 text-primary' : 'text-foreground hover:bg-accent'}" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
      </svg>
      <span>Тарифы и подписка</span>
    <% end %>

    <%= link_to edit_user_registration_path, class: "flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors #{current_page?(edit_user_registration_path) ? 'bg-primary/10 text-primary' : 'text-foreground hover:bg-accent'}" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
      </svg>
      <span>Профиль</span>
    <% end %>

    <!-- Divider -->
    <div class="border-t border-border my-3"></div>

    <!-- Projects Section -->
    <div class="px-3 py-2">
      <p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2">
        Проекты
      </p>
    </div>

    <%= link_to projects_path, class: "flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors #{current_page?(projects_path) ? 'bg-primary/10 text-primary' : 'text-foreground hover:bg-accent'}" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
      </svg>
      <span>Мои проекты</span>
    <% end %>

    <%= link_to analytics_path, class: "flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors #{current_page?(analytics_path) ? 'bg-primary/10 text-primary' : 'text-foreground hover:bg-accent'}" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
      </svg>
      <span>Аналитика</span>
    <% end %>

    <!-- Divider -->
    <div class="border-t border-border my-3"></div>

    <!-- Usage Stats -->
    <% if defined?(@current_subscription) && @current_subscription %>
      <div class="px-3 py-2">
        <p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3">
          Использование
        </p>

        <!-- AI Generations -->
        <div class="mb-4">
          <div class="flex items-center justify-between text-xs mb-1">
            <span class="text-muted-foreground">AI генерации</span>
            <span class="font-medium text-foreground">
              <%= @current_subscription.usage_for(:ai_generations_per_month) %> /
              <%= @current_subscription.limit_for(:ai_generations_per_month) == Float::INFINITY ? '∞' : @current_subscription.limit_for(:ai_generations_per_month) %>
            </span>
          </div>
          <%
            ai_limit = @current_subscription.limit_for(:ai_generations_per_month)
            ai_usage = @current_subscription.usage_for(:ai_generations_per_month)
            ai_percent = ai_limit == Float::INFINITY ? 0 : (ai_usage.to_f / ai_limit * 100).round
          %>
          <div class="w-full bg-muted rounded-full h-1.5">
            <div class="bg-primary h-1.5 rounded-full transition-all" style="width: <%= [ai_percent, 100].min %>%"></div>
          </div>
        </div>

        <!-- Projects -->
        <div class="mb-4">
          <div class="flex items-center justify-between text-xs mb-1">
            <span class="text-muted-foreground">Проекты</span>
            <span class="font-medium text-foreground">
              <%= current_user.projects.count %> /
              <%= @current_subscription.limit_for(:projects) == Float::INFINITY ? '∞' : @current_subscription.limit_for(:projects) %>
            </span>
          </div>
          <%
            projects_limit = @current_subscription.limit_for(:projects)
            projects_count = current_user.projects.count
            projects_percent = projects_limit == Float::INFINITY ? 0 : (projects_count.to_f / projects_limit * 100).round
          %>
          <div class="w-full bg-muted rounded-full h-1.5">
            <div class="bg-primary h-1.5 rounded-full transition-all" style="width: <%= [projects_percent, 100].min %>%"></div>
          </div>
        </div>

        <!-- Posts this month -->
        <div>
          <div class="flex items-center justify-between text-xs mb-1">
            <span class="text-muted-foreground">Посты в месяц</span>
            <span class="font-medium text-foreground">
              <%= @current_subscription.usage_for(:posts_per_month) %> /
              <%= @current_subscription.limit_for(:posts_per_month) == Float::INFINITY ? '∞' : @current_subscription.limit_for(:posts_per_month) %>
            </span>
          </div>
          <%
            posts_limit = @current_subscription.limit_for(:posts_per_month)
            posts_usage = @current_subscription.usage_for(:posts_per_month)
            posts_percent = posts_limit == Float::INFINITY ? 0 : (posts_usage.to_f / posts_limit * 100).round
          %>
          <div class="w-full bg-muted rounded-full h-1.5">
            <div class="bg-primary h-1.5 rounded-full transition-all" style="width: <%= [posts_percent, 100].min %>%"></div>
          </div>
        </div>
      </div>
    <% end %>
  </nav>
</aside>
