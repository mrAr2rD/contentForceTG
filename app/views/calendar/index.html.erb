<div class="max-w-7xl mx-auto px-8 py-8" data-controller="calendar" data-calendar-events-value="<%= @calendar_events.to_json %>">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h1 class="text-xl font-semibold text-foreground">Календарь публикаций</h1>
        <p class="text-xs text-muted-foreground mt-1">Планируйте и управляйте своими постами</p>
      </div>

      <div class="flex items-center gap-3">
        <!-- Project Filter -->
        <% if @projects.any? %>
          <select data-action="change->calendar#filterProject" class="px-3 py-2 border border-input bg-background rounded text-sm focus:ring-1 focus:ring-ring outline-none">
            <option value="">Все проекты</option>
            <% @projects.each do |project| %>
              <option value="<%= project.id %>" <%= 'selected' if @selected_project&.id == project.id %>>
                <%= project.name %>
              </option>
            <% end %>
          </select>
        <% end %>

        <!-- View Toggle -->
        <div class="inline-flex rounded-lg border border-input p-1 bg-background">
          <button data-action="click->calendar#switchView" data-view="month" class="px-3 py-1.5 text-xs font-medium rounded transition-colors bg-primary text-primary-foreground">
            Месяц
          </button>
          <button data-action="click->calendar#switchView" data-view="list" class="px-3 py-1.5 text-xs font-medium rounded transition-colors text-muted-foreground hover:text-foreground">
            Список
          </button>
        </div>

        <%= link_to new_project_post_path(@selected_project || @projects.first), class: "inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg text-xs font-semibold hover:bg-primary/90 transition-colors" do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
          </svg>
          Новый пост
        <% end %>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
    <!-- Main Calendar Area -->
    <div class="lg:col-span-3">
      <!-- Month View -->
      <div data-calendar-target="monthView" class="bg-card border border-border rounded-lg overflow-hidden">
        <!-- Calendar Header -->
        <div class="p-4 border-b border-border flex items-center justify-between bg-muted/30">
          <div class="flex items-center gap-3">
            <button data-action="click->calendar#previousMonth" class="p-2 hover:bg-accent rounded transition-colors">
              <svg class="w-4 h-4 text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <h2 data-calendar-target="monthLabel" class="text-sm font-semibold text-foreground">Январь 2026</h2>
            <button data-action="click->calendar#nextMonth" class="p-2 hover:bg-accent rounded transition-colors">
              <svg class="w-4 h-4 text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>

          <button data-action="click->calendar#goToToday" class="px-3 py-1.5 text-xs font-medium text-muted-foreground hover:text-foreground hover:bg-accent rounded transition-colors">
            Сегодня
          </button>
        </div>

        <!-- Calendar Grid -->
        <div class="p-4">
          <!-- Day names -->
          <div class="grid grid-cols-7 gap-2 mb-2">
            <% %w[Пн Вт Ср Чт Пт Сб Вс].each do |day| %>
              <div class="text-xs font-medium text-muted-foreground text-center py-2">
                <%= day %>
              </div>
            <% end %>
          </div>

          <!-- Calendar days -->
          <div data-calendar-target="calendarGrid" class="grid grid-cols-7 gap-2">
            <!-- Days will be rendered by Stimulus -->
          </div>
        </div>
      </div>

      <!-- List View -->
      <div data-calendar-target="listView" class="hidden bg-card border border-border rounded-lg overflow-hidden">
        <div class="divide-y divide-border" data-calendar-target="listContainer">
          <!-- List will be rendered by Stimulus -->
        </div>
      </div>
    </div>

    <!-- Sidebar: Upcoming Posts -->
    <div class="space-y-4">
      <!-- Upcoming Posts -->
      <div class="bg-card border border-border rounded-lg">
        <div class="p-4 border-b border-border">
          <h3 class="text-sm font-semibold text-foreground">Ближайшие публикации</h3>
        </div>

        <% if @upcoming_posts.any? %>
          <div class="divide-y divide-border max-h-96 overflow-y-auto">
            <% @upcoming_posts.each do |post| %>
              <%= link_to post_path(post), class: "flex items-start gap-3 p-4 hover:bg-accent transition-colors group" do %>
                <div class="flex-shrink-0">
                  <div class="w-2 h-2 rounded-full <%= post.status == 'scheduled' ? 'bg-blue-500' : 'bg-green-500' %> mt-1.5"></div>
                </div>
                <div class="flex-1 min-w-0">
                  <h4 class="text-sm font-medium text-foreground truncate group-hover:text-primary transition-colors">
                    <%= post.title %>
                  </h4>
                  <p class="text-xs text-muted-foreground mt-0.5">
                    <%= post.scheduled_at&.strftime("%d %B, %H:%M") %>
                  </p>
                  <% if post.telegram_bot %>
                    <p class="text-xs text-muted-foreground mt-1 flex items-center gap-1">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18.717-.962 3.767-1.362 5.001-.168.52-.504.694-.826.71-.702.033-1.235-.464-1.913-.908-1.061-.695-1.662-1.127-2.693-1.805-.119-.078-.238-.158-.356-.239a.734.734 0 01.05-1.171c.294-.24 2.661-2.426 2.661-2.426s.172-.177.161-.284a.316.316 0 00-.189-.238 1.02 1.02 0 00-.373-.05c-.177.011-2.986 1.897-8.428 5.571-.797.548-1.52.815-2.165.801-.713-.016-2.082-.403-3.104-.736-.125-.041-.247-.081-.364-.121a.722.722 0 01-.437-.873c.056-.148.146-.258.256-.354.851-.748 8.666-3.758 10.818-4.677 5.112-2.186 6.184-2.568 6.876-2.58.153-.002.495.035.716.214.186.149.238.351.263.494.024.143.056.466.032.72z"/>
                      </svg>
                      <%= post.telegram_bot.channel_name %>
                    </p>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <div class="p-8 text-center">
            <div class="w-12 h-12 bg-muted rounded-full flex items-center justify-center mx-auto mb-3">
              <svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <p class="text-xs text-muted-foreground">Нет запланированных постов</p>
          </div>
        <% end %>
      </div>

      <!-- Stats -->
      <div class="bg-card border border-border rounded-lg">
        <div class="p-4 border-b border-border">
          <h3 class="text-sm font-semibold text-foreground">Статистика</h3>
        </div>
        <div class="p-4 space-y-3 text-xs">
          <div class="flex items-center justify-between">
            <span class="text-muted-foreground">Всего постов</span>
            <span class="font-semibold text-foreground"><%= @posts.count %></span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-muted-foreground">Запланировано</span>
            <span class="font-semibold text-blue-600"><%= @posts.where(status: :scheduled).count %></span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-muted-foreground">Опубликовано</span>
            <span class="font-semibold text-green-600"><%= @posts.where(status: :published).count %></span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-muted-foreground">Черновики</span>
            <span class="font-semibold text-muted-foreground"><%= @posts.where(status: :draft).count %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
