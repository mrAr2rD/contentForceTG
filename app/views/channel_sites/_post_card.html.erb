<%# locals: (post:, featured: false) %>
<article class="card hover:opacity-90 transition-all group overflow-hidden flex flex-col">
  <a href="/post/<%= post.to_param %>" class="block flex-1 flex flex-col">
    <% if post.first_image.present? && featured %>
      <div class="aspect-video -mx-0 -mt-0">
        <img src="<%= channel_post_image_url(post) %>"
             alt="<%= post.display_title %>"
             class="w-full h-full object-cover"
             loading="lazy">
      </div>
    <% end %>

    <div class="p-4 flex-1 flex flex-col">
      <h3 class="text-base font-semibold text-primary group-hover:accent transition-colors mb-2 line-clamp-2">
        <%= post.display_title %>
      </h3>

      <p class="text-secondary text-sm line-clamp-2 mb-3 flex-1">
        <%= post.display_excerpt %>
      </p>

      <div class="flex items-center justify-between text-xs text-secondary mt-auto">
        <div class="flex items-center gap-2">
          <time datetime="<%= post.telegram_date.iso8601 %>">
            <%= post.telegram_date.strftime('%d.%m.%Y') %>
          </time>
          <span class="w-1 h-1 rounded-full" style="background-color: var(--border-color);"></span>
          <span><%= post.views_count %> просм.</span>
        </div>
        <% if post.featured? %>
          <span class="px-1.5 py-0.5 rounded bg-emerald-500/10 text-emerald-400">
            ★
          </span>
        <% end %>
      </div>
    </div>

    <% if post.first_image.present? && !featured %>
      <!-- Fallback layout for non-featured cards without image at top -->
      <div class="hidden">
        <img src="<%= channel_post_image_url(post) %>" alt="" class="w-16 h-16 object-cover rounded-lg">
      </div>
    <% end %>
  </a>
</article>
