<% content_for :title, 'Посты мини-сайта' %>

<div class="max-w-6xl mx-auto px-4 py-8" data-controller="bulk-select" data-bulk-select-url-value="<%= bulk_update_dashboard_channel_site_channel_posts_path(@channel_site) %>">
  <div class="flex items-center gap-2 text-sm text-zinc-500 mb-6">
    <%= link_to 'Мини-сайты', dashboard_channel_sites_path, class: 'hover:text-zinc-700 dark:hover:text-zinc-300' %>
    <span>/</span>
    <%= link_to @channel_site.site_title || @channel_site.telegram_bot.channel_name,
                dashboard_channel_site_path(@channel_site),
                class: 'hover:text-zinc-700 dark:hover:text-zinc-300' %>
    <span>/</span>
    <span>Посты</span>
  </div>

  <div class="flex items-center justify-between mb-8">
    <h1 class="text-2xl font-bold">Посты</h1>

    <div class="flex items-center gap-4">
      <span class="text-sm text-zinc-500">
        Всего: <%= @channel_posts.total_count rescue @channel_posts.count %> постов
      </span>
    </div>
  </div>

  <% if @channel_posts.any? %>
    <%= render 'channel_posts_table', channel_posts: @channel_posts %>

    <!-- Pagination -->
    <% if @channel_posts.respond_to?(:total_pages) && @channel_posts.total_pages > 1 %>
      <nav class="flex items-center justify-center gap-2 mt-8">
        <% if @channel_posts.prev_page %>
          <%= link_to dashboard_channel_site_channel_posts_path(@channel_site, page: @channel_posts.prev_page),
                      class: 'px-4 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors' do %>
            ← Назад
          <% end %>
        <% end %>

        <span class="px-4 py-2 text-zinc-500">
          Страница <%= @channel_posts.current_page %> из <%= @channel_posts.total_pages %>
        </span>

        <% if @channel_posts.next_page %>
          <%= link_to dashboard_channel_site_channel_posts_path(@channel_site, page: @channel_posts.next_page),
                      class: 'px-4 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors' do %>
            Вперёд →
          <% end %>
        <% end %>
      </nav>
    <% end %>

    <!-- Bulk Action Bar (fixed at bottom) -->
    <div data-bulk-select-target="actionBar"
         class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-zinc-900 dark:bg-zinc-800 border border-zinc-700 rounded-xl shadow-2xl px-6 py-3 flex items-center gap-4 transition-all duration-200 translate-y-full opacity-0 z-50">
      <span class="text-sm text-zinc-400">
        Выбрано: <span data-bulk-select-target="selectedCount" class="font-medium text-white">0</span>
      </span>

      <div class="h-6 w-px bg-zinc-700"></div>

      <button type="button"
              data-action="bulk-select#show"
              class="px-3 py-1.5 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors text-sm font-medium">
        Показать
      </button>

      <button type="button"
              data-action="bulk-select#hide"
              class="px-3 py-1.5 rounded-lg bg-zinc-500/20 text-zinc-400 hover:bg-zinc-500/30 transition-colors text-sm font-medium">
        Скрыть
      </button>

      <button type="button"
              data-action="bulk-select#feature"
              class="px-3 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 transition-colors text-sm font-medium">
        ★ В избранное
      </button>

      <button type="button"
              data-action="bulk-select#unfeature"
              class="px-3 py-1.5 rounded-lg bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 transition-colors text-sm font-medium">
        Убрать из избранного
      </button>
    </div>
  <% else %>
    <div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-12 text-center">
      <p class="text-zinc-500">Постов пока нет. Запустите синхронизацию для загрузки контента.</p>
      <%= button_to sync_dashboard_channel_site_path(@channel_site),
                    method: :post,
                    class: 'mt-4 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors' do %>
        Синхронизировать
      <% end %>
    </div>
  <% end %>
</div>
