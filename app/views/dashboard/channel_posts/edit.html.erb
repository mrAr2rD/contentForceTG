<% content_for :title, 'Редактирование поста' %>

<div class="max-w-2xl mx-auto px-4 py-8">
  <div class="flex items-center gap-2 text-sm text-zinc-500 mb-6">
    <%= link_to 'Мини-сайты', dashboard_channel_sites_path, class: 'hover:text-zinc-700 dark:hover:text-zinc-300' %>
    <span>/</span>
    <%= link_to @channel_site.site_title || @channel_site.telegram_bot.channel_name,
                dashboard_channel_site_path(@channel_site),
                class: 'hover:text-zinc-700 dark:hover:text-zinc-300' %>
    <span>/</span>
    <%= link_to 'Посты', dashboard_channel_site_channel_posts_path(@channel_site),
                class: 'hover:text-zinc-700 dark:hover:text-zinc-300' %>
    <span>/</span>
    <span>Редактирование</span>
  </div>

  <h1 class="text-2xl font-bold mb-8">Редактирование поста</h1>

  <%= form_with model: [@channel_site, @channel_post],
                url: dashboard_channel_site_channel_post_path(@channel_site, @channel_post),
                class: 'space-y-8' do |form| %>
    <% if @channel_post.errors.any? %>
      <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4">
        <ul class="list-disc list-inside text-red-700 dark:text-red-300 text-sm">
          <% @channel_post.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Visibility & Featured -->
    <div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6">
      <h3 class="font-semibold mb-4">Отображение</h3>

      <div class="space-y-4">
        <div>
          <%= form.label :visibility, 'Видимость', class: 'block text-sm font-medium mb-2' %>
          <%= form.select :visibility,
                          [['Автоматически', 'auto'], ['Всегда показывать', 'visible'], ['Скрыть', 'hidden']],
                          {},
                          class: 'w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 focus:ring-2 focus:ring-emerald-500 focus:border-transparent' %>
          <p class="text-sm text-zinc-500 mt-1">Авто — показывать если есть достаточно контента.</p>
        </div>

        <div class="flex items-center gap-3">
          <%= form.check_box :featured,
                             class: 'w-5 h-5 rounded border-zinc-300 dark:border-zinc-700 text-emerald-500 focus:ring-emerald-500' %>
          <%= form.label :featured, 'Показывать в избранном на главной', class: 'text-sm' %>
        </div>
      </div>
    </div>

    <!-- Title & Slug -->
    <div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6">
      <h3 class="font-semibold mb-4">Заголовок и URL</h3>

      <div class="space-y-4">
        <div>
          <%= form.label :title, 'Заголовок', class: 'block text-sm font-medium mb-2' %>
          <%= form.text_field :title,
                              placeholder: 'Оставьте пустым для автогенерации',
                              class: 'w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 focus:ring-2 focus:ring-emerald-500 focus:border-transparent' %>
          <p class="text-sm text-zinc-500 mt-1">Автогенерация: <%= @channel_post.send(:extract_title_from_text)&.truncate(50) %></p>
        </div>

        <div>
          <%= form.label :slug, 'URL (slug)', class: 'block text-sm font-medium mb-2' %>
          <%= form.text_field :slug,
                              class: 'w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 focus:ring-2 focus:ring-emerald-500 focus:border-transparent' %>
          <p class="text-sm text-zinc-500 mt-1">Только латинские буквы, цифры и дефисы.</p>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6">
      <h3 class="font-semibold mb-4">Контент</h3>

      <div class="space-y-4">
        <div>
          <%= form.label :content, 'Текст (переопределяет оригинал)', class: 'block text-sm font-medium mb-2' %>
          <%= form.text_area :content,
                             rows: 10,
                             placeholder: 'Оставьте пустым для использования оригинала из Telegram',
                             class: 'w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-y' %>
        </div>

        <div>
          <%= form.label :excerpt, 'Краткое описание', class: 'block text-sm font-medium mb-2' %>
          <%= form.text_area :excerpt,
                             rows: 3,
                             maxlength: 500,
                             placeholder: 'Автогенерируется из контента',
                             class: 'w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none' %>
        </div>
      </div>
    </div>

    <!-- Original Content (readonly) -->
    <div class="bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6">
      <h3 class="font-semibold mb-4 text-zinc-500">Оригинал из Telegram</h3>
      <div class="prose dark:prose-invert max-w-none text-sm opacity-75">
        <%= simple_format(@channel_post.original_text) %>
      </div>
    </div>

    <!-- Submit -->
    <div class="flex items-center justify-end gap-4">
      <%= link_to 'Отмена', dashboard_channel_site_channel_posts_path(@channel_site),
                  class: 'px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors' %>
      <%= form.submit 'Сохранить',
                      class: 'px-6 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors cursor-pointer' %>
    </div>
  <% end %>
</div>
