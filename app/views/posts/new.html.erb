<div class="max-w-4xl mx-auto px-8 py-8">
  <!-- Header -->
  <div class="mb-6">
    <%= link_to posts_path, class: "inline-flex items-center gap-2 text-xs text-muted-foreground hover:text-foreground mb-3 transition-colors" do %>
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
      </svg>
      Назад к постам
    <% end %>
    <h1 class="text-xl font-semibold text-foreground">Новый пост</h1>
  </div>

  <!-- Form -->
  <div class="bg-card border border-border rounded-lg">
    <%= form_with model: @post, local: true, class: "p-6 space-y-5" do |f| %>
      <% if @post.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-md p-3">
          <ul class="text-xs text-red-700 space-y-0.5">
            <% @post.errors.full_messages.each do |error| %>
              <li>• <%= error %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="grid grid-cols-2 gap-4">
        <div class="space-y-2">
          <%= f.label :project_id, "Проект", class: "text-sm font-medium text-foreground" %>
          <%= f.collection_select :project_id, current_user.projects, :id, :name, { prompt: "Выберите проект" }, class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
        </div>

        <div class="space-y-2">
          <%= f.label :telegram_bot_id, "Telegram бот", class: "text-sm font-medium text-foreground" %>
          <%= f.collection_select :telegram_bot_id, TelegramBot.joins(:project).where(projects: { user_id: current_user.id }), :id, :display_name, { prompt: "Выберите бота" }, class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
        </div>
      </div>

      <div class="space-y-2">
        <%= f.label :title, "Заголовок", class: "text-sm font-medium text-foreground" %>
        <%= f.text_field :title, placeholder: "Введите заголовок поста...", class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
      </div>

      <div class="space-y-2">
        <%= f.label :content, "Содержимое", class: "text-sm font-medium text-foreground" %>
        <%= f.text_area :content, rows: 12, placeholder: "Напишите текст поста...\n\nИспользуйте **жирный** и *курсив* для форматирования", class: "flex min-h-[200px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 font-mono" %>
        <div class="flex items-center justify-between text-xs text-muted-foreground">
          <span>Markdown: **жирный**, *курсив*, `код`</span>
          <span id="char-count">0 / 4096</span>
        </div>
      </div>

      <!-- AI Editor Link -->
      <div class="bg-muted border border-border rounded-md p-3">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-background rounded flex items-center justify-center">
            <svg class="w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="text-xs font-medium text-foreground">AI-генерация</h4>
            <p class="text-xs text-muted-foreground">Используйте AI для создания контента</p>
          </div>
          <%= link_to editor_posts_path, class: "inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-3 py-2 text-xs font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" do %>
            Открыть редактор
          <% end %>
        </div>
      </div>

      <div class="pt-4 flex items-center gap-3 border-t border-border">
        <%= f.submit "Сохранить черновик", class: "inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" %>
        <%= link_to "Отмена", posts_path, class: "inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const content = document.querySelector('textarea[name="post[content]"]');
    const charCount = document.getElementById('char-count');
    
    if (content && charCount) {
      content.addEventListener('input', function() {
        charCount.textContent = `${this.value.length} / 4096`;
        if (this.value.length > 4096) {
          charCount.classList.add('text-red-500');
        } else {
          charCount.classList.remove('text-red-500');
        }
      });
    }
  });
</script>
