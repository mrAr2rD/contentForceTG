<div data-controller="post-editor chat" class="h-screen flex flex-col bg-white dark:bg-zinc-950">
  <!-- Header - Notion style -->
  <header class="h-14 border-b border-zinc-200 dark:border-zinc-800 px-6 flex items-center justify-between bg-white dark:bg-zinc-950">
    <div class="flex items-center gap-4">
      <%= link_to posts_path, class: "p-2 text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-50 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
      <% end %>
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        <h1 class="text-base font-semibold text-zinc-900 dark:text-zinc-50">AI –†–µ–¥–∞–∫—Ç–æ—Ä</h1>
      </div>
    </div>
    
    <div class="flex items-center gap-2">
      <% if @post.persisted? %>
        <%= link_to @post, class: "inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-zinc-700 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors" do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          –ü—Ä–æ—Å–º–æ—Ç—Ä
        <% end %>
      <% end %>
      <button 
        data-action="click->post-editor#save" 
        class="inline-flex items-center gap-2 px-4 py-1.5 bg-zinc-900 text-zinc-50 hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90 rounded-md text-sm font-medium transition-colors shadow-sm"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
        </svg>
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>
  </header>

  <!-- Three Panel Layout - Notion style -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Left Panel: AI Chat (30%) -->
    <aside class="w-[30%] bg-zinc-50 dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col">
      <div class="px-6 py-4 border-b border-zinc-200 dark:border-zinc-800">
        <h2 class="text-sm font-semibold text-zinc-900 dark:text-zinc-50 flex items-center gap-2">
          <div class="w-6 h-6 bg-gradient-to-br from-primary-500 to-primary-600 rounded-md flex items-center justify-center">
            <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
        </h2>
      </div>
      
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Chat Messages -->
        <div data-chat-target="messages" class="flex-1 overflow-y-auto notion-scrollbar px-6 py-4 space-y-4">
          <div class="bg-primary-50 dark:bg-primary-950/20 border border-primary-200 dark:border-primary-900 rounded-lg p-4">
            <p class="text-sm text-primary-900 dark:text-primary-100 font-medium mb-2">üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç.</p>
            <p class="text-sm text-primary-800 dark:text-primary-200">–ù–∞–ø–∏—à–∏ —Ç–µ–º—É –∏–ª–∏ –∏–¥–µ—é, –∏ —è —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é —Ç–µ–∫—Å—Ç –¥–ª—è Telegram.</p>
          </div>
        </div>
        
        <!-- Chat Input -->
        <div class="px-6 py-4 border-t border-zinc-200 dark:border-zinc-800">
          <form data-action="submit->chat#sendMessage" class="flex gap-2">
            <input 
              type="text" 
              data-chat-target="input"
              placeholder="–ù–∞–ø–∏—à–∏ —Ç–µ–º—É –ø–æ—Å—Ç–∞..."
              class="flex-1 h-10 px-3 py-2 border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 rounded-md text-sm text-zinc-900 dark:text-zinc-50 placeholder:text-zinc-500 dark:placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-zinc-950 dark:focus:ring-zinc-300 focus:ring-offset-2 dark:ring-offset-zinc-950 transition-shadow"
            >
            <button 
              type="submit"
              data-chat-target="submitButton"
              class="inline-flex items-center justify-center h-10 px-4 bg-zinc-900 text-zinc-50 hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90 rounded-md text-sm font-medium transition-colors"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
              </svg>
            </button>
          </form>
        </div>
      </div>
    </aside>

    <!-- Center Panel: Settings (20%) -->
    <aside class="w-[20%] bg-white dark:bg-zinc-950 border-r border-zinc-200 dark:border-zinc-800 overflow-y-auto notion-scrollbar">
      <div class="px-6 py-4 border-b border-zinc-200 dark:border-zinc-800">
        <h2 class="text-sm font-semibold text-zinc-900 dark:text-zinc-50">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      </div>
      
      <%= form_with model: @post, url: @post.persisted? ? post_path(@post) : posts_path, method: @post.persisted? ? :patch : :post, local: true, data: { post_editor_target: "form" }, class: "px-6 py-4 space-y-6" do |f| %>
        <!-- Project -->
        <div>
          <%= f.label :project_id, "–ü—Ä–æ–µ–∫—Ç", class: "block text-sm font-medium text-zinc-900 dark:text-zinc-50 mb-2" %>
          <%= f.collection_select :project_id, current_user.projects.active, :id, :name, 
              { prompt: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç" }, 
              { class: "flex h-10 w-full rounded-md border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-3 py-2 text-sm text-zinc-900 dark:text-zinc-50 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 transition-shadow" } %>
        </div>

        <!-- Telegram Bot -->
        <div>
          <%= f.label :telegram_bot_id, "Telegram –ë–æ—Ç", class: "block text-sm font-medium text-zinc-900 dark:text-zinc-50 mb-2" %>
          <%= f.collection_select :telegram_bot_id, @telegram_bots, :id, :display_name, 
              { prompt: "–í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞", include_blank: true }, 
              { class: "flex h-10 w-full rounded-md border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-3 py-2 text-sm text-zinc-900 dark:text-zinc-50 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 transition-shadow" } %>
        </div>

        <!-- Title -->
        <div>
          <%= f.label :title, "–ó–∞–≥–æ–ª–æ–≤–æ–∫", class: "block text-sm font-medium text-zinc-900 dark:text-zinc-50 mb-2" %>
          <%= f.text_field :title, 
              placeholder: "–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞",
              class: "flex h-10 w-full rounded-md border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-3 py-2 text-sm text-zinc-900 dark:text-zinc-50 placeholder:text-zinc-500 dark:placeholder:text-zinc-400 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 transition-shadow" %>
        </div>

        <%# TODO: Add tone_of_voice and post_type columns to posts table %>
        <%# Tone of Voice %>
        <%# <div> %>
        <%#   <%= f.label :tone_of_voice, "–¢–æ–Ω –≥–æ–ª–æ—Å–∞", class: "block text-sm font-medium text-zinc-900 dark:text-zinc-50 mb-2" %>
        <%#   <%= f.select :tone_of_voice,  %>
        <%#       Post.tone_of_voices.keys.map { |k| [k.humanize, k] }, %>
        <%#       { include_blank: "–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é" }, %>
        <%#       { class: "flex h-10 w-full rounded-md border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-3 py-2 text-sm text-zinc-900 dark:text-zinc-50 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 transition-shadow" } %>
        <%# </div> %>

        <%# Post Type %>
        <%# <div> %>
        <%#   <%= f.label :post_type, "–¢–∏–ø –ø–æ—Å—Ç–∞", class: "block text-sm font-medium text-zinc-900 dark:text-zinc-50 mb-2" %>
        <%#   <%= f.select :post_type,  %>
        <%#       Post.post_types.keys.map { |k| [k.humanize, k] }, %>
        <%#       {}, %>
        <%#       { class: "flex h-10 w-full rounded-md border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-3 py-2 text-sm text-zinc-900 dark:text-zinc-50 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 transition-shadow" } %>
        <%# </div> %>

        <!-- Hidden fields -->
        <%= f.hidden_field :content, data: { post_editor_target: "content" } %>
      <% end %>
    </aside>

    <!-- Right Panel: Preview & Editor (50%) -->
    <main class="flex-1 bg-white dark:bg-zinc-950 overflow-y-auto notion-scrollbar">
      <div class="max-w-3xl mx-auto px-12 py-8">
        <!-- Preview Header -->
        <div class="mb-6 flex items-center justify-between">
          <h2 class="text-base font-semibold text-zinc-900 dark:text-zinc-50">–ü—Ä–µ–≤—å—é –ø–æ—Å—Ç–∞</h2>
          <div class="flex items-center gap-2 text-xs text-zinc-500 dark:text-zinc-400">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
          </div>
        </div>

        <!-- Telegram Preview Card - Real Telegram Style -->
        <div class="mb-8 rounded-2xl border border-zinc-200 dark:border-zinc-700 overflow-hidden shadow-lg hover:shadow-xl transition-shadow bg-white dark:bg-zinc-900">
          <!-- Channel Header (–∫–∞–∫ –≤ Telegram) -->
          <div class="bg-white dark:bg-zinc-900 px-4 py-3 border-b border-zinc-100 dark:border-zinc-800">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18.717-.962 3.767-1.362 5.001-.168.52-.504.694-.826.71-.702.033-1.235-.464-1.913-.908-1.061-.695-1.662-1.127-2.693-1.805-.119-.078-.238-.158-.356-.239a.734.734 0 01.05-1.171c.294-.24 2.661-2.426 2.661-2.426s.172-.177.161-.284a.316.316 0 00-.189-.238 1.02 1.02 0 00-.373-.05c-.177.011-2.986 1.897-8.428 5.571-.797.548-1.52.815-2.165.801-.713-.016-2.082-.403-3.104-.736-.125-.041-.247-.081-.364-.121a.722.722 0 01-.437-.873c.056-.148.146-.258.256-.354.851-.748 8.666-3.758 10.818-4.677 5.112-2.186 6.184-2.568 6.876-2.58.153-.002.495.035.716.214.186.149.238.351.263.494.024.143.056.466.032.72z"/>
                </svg>
              </div>
              <div class="flex-1">
                <p class="text-zinc-900 dark:text-zinc-50 font-semibold text-sm">
                  <%= @post.telegram_bot&.channel_name || "–í–∞—à –ö–∞–Ω–∞–ª" %>
                </p>
                <p class="text-zinc-500 dark:text-zinc-400 text-xs"><%= Time.current.strftime("%H:%M") %></p>
              </div>
            </div>
          </div>

          <!-- Post Image (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
          <div data-post-editor-target="imagePreview" class="hidden">
            <img src="" alt="Post image" class="w-full object-cover max-h-96" />
          </div>

          <!-- Post Content: Title + Text (–∫–∞–∫ –≤ Telegram) -->
          <div class="bg-white dark:bg-zinc-900 px-4 py-3">
            <!-- Title (–∂–∏—Ä–Ω—ã–π, –∫–∞–∫ –≤ Telegram) -->
            <h3 data-post-editor-target="titlePreview" class="text-base font-bold text-zinc-900 dark:text-zinc-50 mb-2 hidden"></h3>

            <!-- Content -->
            <div data-post-editor-target="preview" class="text-sm text-zinc-900 dark:text-zinc-50 leading-relaxed">
              <p class="text-zinc-400 dark:text-zinc-500 italic">
                –ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...
              </p>
            </div>
          </div>

          <!-- Post Meta (views, reactions) -->
          <div class="bg-white dark:bg-zinc-900 px-4 py-2 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between text-xs">
            <div class="flex items-center gap-4 text-zinc-500 dark:text-zinc-400">
              <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
                1.2k
              </span>
            </div>
            <span data-post-editor-target="charCount" class="font-medium text-zinc-500 dark:text-zinc-400">0 / 4096</span>
          </div>
        </div>

        <!-- Content Editor - Notion style -->
        <div class="mb-8">
          <label class="block text-sm font-medium text-zinc-900 dark:text-zinc-50 mb-3">
            –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞
          </label>
          <div class="rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 focus-within:ring-2 focus-within:ring-zinc-950 dark:focus-within:ring-zinc-300 focus-within:ring-offset-2 dark:ring-offset-zinc-950 transition-shadow">
            <textarea 
              data-post-editor-target="contentEditor"
              data-action="input->post-editor#updatePreview"
              rows="16"
              placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Markdown:
**–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç**
*–∫—É—Ä—Å–∏–≤*
`–∫–æ–¥`
[—Å—Å—ã–ª–∫–∞](https://example.com)"
              class="w-full px-6 py-4 bg-transparent text-sm text-zinc-900 dark:text-zinc-50 placeholder:text-zinc-400 dark:placeholder:text-zinc-600 focus:outline-none resize-none font-mono leading-relaxed"
            ><%= @post.content %></textarea>
          </div>
          <p class="mt-2 text-xs text-zinc-500 dark:text-zinc-400">
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
          </p>
        </div>

        <!-- Quick Actions - Notion style -->
        <div class="flex flex-wrap gap-2">
          <button 
            type="button"
            class="inline-flex items-center gap-2 px-3 py-1.5 border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 rounded-md text-xs font-medium text-zinc-700 dark:text-zinc-300 transition-colors"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            –î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏
          </button>
          <button 
            type="button"
            class="inline-flex items-center gap-2 px-3 py-1.5 border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 rounded-md text-xs font-medium text-zinc-700 dark:text-zinc-300 transition-colors"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
            </svg>
            –î–æ–±–∞–≤–∏—Ç—å —Ö–µ—à—Ç–µ–≥–∏
          </button>
          <button 
            type="button"
            class="inline-flex items-center gap-2 px-3 py-1.5 border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 rounded-md text-xs font-medium text-zinc-700 dark:text-zinc-300 transition-colors"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          </button>
        </div>
      </div>
    </main>
  </div>
</div>
