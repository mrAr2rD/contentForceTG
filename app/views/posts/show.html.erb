<div class="max-w-7xl mx-auto px-8 py-8">
  <!-- Header -->
  <div class="mb-6">
    <%= link_to posts_path, class: "inline-flex items-center gap-2 text-xs text-muted-foreground hover:text-foreground mb-3 transition-colors" do %>
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
      </svg>
      Назад к постам
    <% end %>

    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-xl font-semibold text-foreground"><%= @post.title %></h1>
        <div class="flex items-center gap-2 mt-1">
          <% case @post.status %>
          <% when "published" %>
            <span class="px-2 py-0.5 bg-green-50 text-green-700 text-xs font-medium rounded">Опубликован</span>
          <% when "scheduled" %>
            <span class="px-2 py-0.5 bg-blue-50 text-blue-700 text-xs font-medium rounded">Запланирован</span>
          <% when "draft" %>
            <span class="px-2 py-0.5 bg-muted text-muted-foreground text-xs font-medium rounded">Черновик</span>
          <% when "failed" %>
            <span class="px-2 py-0.5 bg-red-50 text-red-700 text-xs font-medium rounded">Ошибка</span>
          <% end %>
          <% if @post.project %>
            <span class="text-xs text-muted-foreground">в <%= link_to @post.project.name, project_path(@post.project), class: "hover:text-foreground transition-colors" %></span>
          <% end %>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <%= link_to edit_post_path(@post), class: "inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-3 py-2 text-xs font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" do %>
          Редактировать
        <% end %>
        <% if @post.draft? && @post.telegram_bot %>
          <%= button_to publish_post_path(@post), method: :post, class: "inline-flex h-9 items-center justify-center rounded-md bg-green-600 px-3 py-2 text-xs font-semibold text-white ring-offset-background transition-colors hover:bg-green-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" do %>
            Опубликовать
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <!-- Content -->
    <div class="lg:col-span-2 space-y-4">
      <div class="bg-card border border-border rounded-lg">
        <div class="p-4 border-b border-border">
          <h2 class="text-sm font-semibold text-foreground">Содержимое</h2>
        </div>
        <div class="p-6 prose prose-sm max-w-none">
          <%= simple_format(@post.content) %>
        </div>
      </div>

      <!-- Telegram Preview -->
      <div class="bg-gradient-to-b from-blue-400 to-blue-500 rounded-lg p-4">
        <h3 class="text-white text-xs font-medium mb-3">Превью в Telegram</h3>
        <div class="bg-white rounded-md p-4">
          <div class="prose prose-sm max-w-none">
            <%= raw(@post.content
              .gsub(/\*\*(.+?)\*\*/, '<b>\1</b>')
              .gsub(/\*(.+?)\*/, '<i>\1</i>')
              .gsub(/`(.+?)`/, '<code class="bg-slate-100 px-1 rounded text-xs">\1</code>')
              .gsub(/\n/, '<br>')) %>
          </div>
          <div class="mt-2 text-xs text-muted-foreground">
            <%= @post.published_at&.strftime("%H:%M") || Time.current.strftime("%H:%M") %>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-4">
      <!-- Info -->
      <div class="bg-card border border-border rounded-lg">
        <div class="p-4 border-b border-border">
          <h3 class="text-xs font-semibold text-foreground">Информация</h3>
        </div>
        <div class="p-4 space-y-3 text-xs">
          <div class="flex items-center justify-between">
            <span class="text-muted-foreground">Создан</span>
            <span class="text-foreground"><%= @post.created_at.strftime("%d.%m.%Y %H:%M") %></span>
          </div>
          <% if @post.published_at %>
            <div class="flex items-center justify-between">
              <span class="text-muted-foreground"><%= @post.published? ? 'Опубликован' : 'Запланирован на' %></span>
              <span class="text-foreground"><%= @post.published_at.strftime("%d.%m.%Y %H:%M") %></span>
            </div>
          <% end %>
          <div class="flex items-center justify-between">
            <span class="text-muted-foreground">Символов</span>
            <span class="text-foreground"><%= @post.content.length %> / 4096</span>
          </div>
        </div>
      </div>

      <!-- Telegram Bot -->
      <div class="bg-card border border-border rounded-lg">
        <div class="p-4 border-b border-border">
          <h3 class="text-xs font-semibold text-foreground">Публикация</h3>
        </div>
        <div class="p-4">
          <% if @post.telegram_bot %>
            <div class="flex items-center gap-2 p-2 bg-muted rounded-md">
              <div class="w-6 h-6 bg-background rounded flex items-center justify-center">
                <svg class="w-3 h-3 text-muted-foreground" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0z"/>
                </svg>
              </div>
              <div>
                <p class="text-xs font-medium text-foreground">@<%= @post.telegram_bot.bot_username %></p>
                <p class="text-xs text-muted-foreground"><%= @post.telegram_bot.channel_name %></p>
              </div>
            </div>
          <% else %>
            <p class="text-xs text-muted-foreground mb-2">Бот не выбран</p>
            <%= link_to "Выбрать бота", edit_post_path(@post), class: "text-xs text-muted-foreground hover:text-foreground transition-colors" %>
          <% end %>
        </div>
      </div>

      <!-- Schedule -->
      <% if @post.draft? %>
        <div class="bg-card border border-border rounded-lg">
          <div class="p-4 border-b border-border">
            <h3 class="text-xs font-semibold text-foreground">Запланировать</h3>
          </div>
          <div class="p-4">
            <%= form_with url: schedule_post_path(@post), method: :post, local: true, class: "space-y-3" do %>
              <input type="datetime-local" name="scheduled_at" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-xs ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" min="<%= Time.current.strftime('%Y-%m-%dT%H:%M') %>">
              <button type="submit" class="inline-flex h-10 w-full items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-xs font-semibold text-white ring-offset-background transition-colors hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                Запланировать
              </button>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Actions -->
      <div class="bg-card border border-border rounded-lg">
        <div class="p-4 border-b border-border">
          <h3 class="text-xs font-semibold text-foreground">Действия</h3>
        </div>
        <div class="p-4">
          <%= button_to post_path(@post), method: :delete, data: { turbo_confirm: "Удалить пост?" }, class: "w-full h-9 text-xs font-medium text-red-600 hover:bg-red-50 rounded-md transition-colors text-left px-2" do %>
            Удалить пост
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
