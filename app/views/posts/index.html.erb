<% content_for :title, "Посты" %>

<style>
  .posts-tech {
    --accent: #00D4AA;
    --accent-glow: rgba(0, 212, 170, 0.5);
    --accent-dim: rgba(0, 212, 170, 0.15);
    --bg-card: rgba(17, 17, 19, 0.8);
    --border-color: rgba(255, 255, 255, 0.06);
    --text-primary: #FAFAFA;
    --text-secondary: #A1A1AA;
    --text-muted: #71717A;
  }

  .page-header-tech {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .page-title-tech {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .page-title-tech .title-icon {
    width: 40px;
    height: 40px;
    background: var(--accent-dim);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .page-subtitle-tech {
    font-size: 14px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .action-btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: linear-gradient(135deg, var(--accent), #00B894);
    color: #0A0A0B;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s ease;
    border: none;
    box-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
  }

  .action-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 0 30px rgba(0, 212, 170, 0.5);
  }

  /* Filters */
  .filters-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border-color);
    overflow-x: auto;
  }

  .filter-btn {
    display: inline-flex;
    align-items: center;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-muted);
    background: transparent;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .filter-btn:hover {
    color: var(--text-secondary);
    background: rgba(255, 255, 255, 0.03);
  }

  .filter-btn.active {
    color: var(--accent);
    background: var(--accent-dim);
    border-color: rgba(0, 212, 170, 0.2);
  }

  /* Posts List */
  .posts-list {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    overflow: hidden;
  }

  .post-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    transition: all 0.2s ease;
  }

  .post-item:last-child {
    border-bottom: none;
  }

  .post-item:hover {
    background: rgba(0, 212, 170, 0.02);
  }

  .post-item .post-status-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .post-item .post-status-icon.published {
    background: rgba(34, 197, 94, 0.15);
  }

  .post-item .post-status-icon.scheduled {
    background: rgba(234, 179, 8, 0.15);
  }

  .post-item .post-status-icon.failed {
    background: rgba(239, 68, 68, 0.15);
  }

  .post-item .post-status-icon.draft {
    background: rgba(161, 161, 170, 0.15);
  }

  .post-item .post-content {
    flex: 1;
    min-width: 0;
  }

  .post-item .post-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
    flex-wrap: wrap;
  }

  .post-item .post-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    transition: color 0.2s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 400px;
  }

  .post-item .post-title:hover {
    color: var(--accent);
  }

  .post-item .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    flex-shrink: 0;
  }

  .post-item .status-badge.published {
    background: rgba(34, 197, 94, 0.15);
    color: #22C55E;
  }

  .post-item .status-badge.scheduled {
    background: rgba(234, 179, 8, 0.15);
    color: #EAB308;
  }

  .post-item .status-badge.draft {
    background: rgba(161, 161, 170, 0.15);
    color: #A1A1AA;
  }

  .post-item .status-badge.failed {
    background: rgba(239, 68, 68, 0.15);
    color: #EF4444;
  }

  .post-item .post-excerpt {
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 10px;
  }

  .post-item .post-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .post-item .meta-item {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    color: var(--text-muted);
  }

  .post-item .meta-item svg {
    width: 12px;
    height: 12px;
  }

  .post-item .post-actions {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }

  .post-item .action-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    color: var(--text-muted);
    transition: all 0.2s ease;
  }

  .post-item .action-btn:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
  }

  .post-item .action-btn.edit:hover {
    color: var(--accent);
    background: var(--accent-dim);
  }

  .post-item .action-btn.publish:hover {
    color: #22C55E;
    background: rgba(34, 197, 94, 0.15);
  }

  /* Empty State */
  .empty-state-tech {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 64px 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .empty-state-tech::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(0, 212, 170, 0.05), transparent 70%);
    pointer-events: none;
  }

  .empty-state-tech .empty-icon {
    width: 56px;
    height: 56px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    position: relative;
  }

  .empty-state-tech .empty-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
    position: relative;
  }

  .empty-state-tech .empty-text {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 20px;
    position: relative;
  }
</style>

<div class="posts-tech">
  <!-- Header -->
  <div class="page-header-tech">
    <div>
      <h1 class="page-title-tech">
        <div class="title-icon">
          <svg class="w-5 h-5" style="color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
        </div>
        Посты
      </h1>
      <p class="page-subtitle-tech">Управляйте контентом для публикации</p>
    </div>
    <%= link_to new_post_path, class: "action-btn-primary" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
      </svg>
      Новый пост
    <% end %>
  </div>

  <!-- Filters -->
  <div class="filters-bar">
    <%= link_to posts_path, class: "filter-btn #{params[:status].blank? ? 'active' : ''}" do %>
      Все
    <% end %>
    <%= link_to posts_path(status: 'draft'), class: "filter-btn #{params[:status] == 'draft' ? 'active' : ''}" do %>
      Черновики
    <% end %>
    <%= link_to posts_path(status: 'scheduled'), class: "filter-btn #{params[:status] == 'scheduled' ? 'active' : ''}" do %>
      Запланированные
    <% end %>
    <%= link_to posts_path(status: 'published'), class: "filter-btn #{params[:status] == 'published' ? 'active' : ''}" do %>
      Опубликованные
    <% end %>
  </div>

  <% if @posts.any? %>
    <div class="posts-list">
      <% @posts.each do |post| %>
        <div class="post-item">
          <div class="post-status-icon <%= post.status %>">
            <svg class="w-5 h-5" style="<%=
              case post.status
              when 'published' then 'color: #22C55E;'
              when 'scheduled' then 'color: #EAB308;'
              when 'failed' then 'color: #EF4444;'
              else 'color: #A1A1AA;'
              end %>" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <% if post.status == 'published' %>
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
              <% elsif post.status == 'scheduled' %>
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              <% elsif post.status == 'failed' %>
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              <% else %>
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              <% end %>
            </svg>
          </div>

          <div class="post-content">
            <div class="post-header">
              <%= link_to post.title.presence || post.content.truncate(50), post_path(post), class: "post-title" %>
              <span class="status-badge <%= post.status %>">
                <% case post.status %>
                <% when "published" %>Опубликован
                <% when "scheduled" %>Запланирован
                <% when "draft" %>Черновик
                <% when "failed" %>Ошибка
                <% end %>
              </span>
            </div>

            <p class="post-excerpt"><%= post.content.truncate(150) %></p>

            <div class="post-meta">
              <% if post.project %>
                <span class="meta-item">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                  </svg>
                  <%= post.project.name %>
                </span>
              <% end %>
              <% if post.telegram_bot %>
                <span class="meta-item">
                  <svg fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0z"/>
                  </svg>
                  @<%= post.telegram_bot.bot_username %>
                </span>
              <% end %>
              <span class="meta-item">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <%= time_ago_in_words(post.created_at) %> назад
              </span>
            </div>
          </div>

          <div class="post-actions">
            <%= link_to editor_posts_path(post_id: post.id), class: "action-btn edit", title: "Редактировать" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            <% end %>
            <% if post.draft? && post.telegram_bot %>
              <%= button_to publish_post_path(post), method: :post, class: "action-btn publish", title: "Опубликовать" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                </svg>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="empty-state-tech">
      <div class="empty-icon">
        <svg class="w-7 h-7" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <h3 class="empty-title">Нет постов</h3>
      <p class="empty-text">Создайте первый пост для вашего канала</p>
      <%= link_to new_post_path, class: "action-btn-primary" do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
        Создать первый пост
      <% end %>
    </div>
  <% end %>
</div>
