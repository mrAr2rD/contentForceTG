<%# locals: (article:) %>

<%= form_with model: [:admin, article], class: "space-y-6", data: { controller: "article-generator" } do |f| %>
  <% if article.errors.any? %>
    <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
      <h3 class="text-red-700 dark:text-red-400 font-medium mb-2">Ошибки:</h3>
      <ul class="list-disc list-inside text-sm text-red-600 dark:text-red-400">
        <% article.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Title -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <div class="space-y-4">
          <div>
            <%= f.label :title, "Заголовок", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
            <%= f.text_field :title, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent", placeholder: "Введите заголовок статьи" %>
          </div>

          <div>
            <%= f.label :slug, "URL (slug)", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
            <div class="flex items-center">
              <span class="text-zinc-500 dark:text-zinc-400 mr-2">/articles/</span>
              <%= f.text_field :slug, class: "flex-1 px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent font-mono", placeholder: "my-article-slug" %>
            </div>
            <p class="mt-1 text-xs text-zinc-500 dark:text-zinc-400">Оставьте пустым для автоматической генерации из заголовка</p>
          </div>
        </div>
      </div>

      <!-- AI Generator -->
      <div class="bg-gradient-to-r from-primary-50 to-primary-100 dark:from-primary-900/20 dark:to-primary-800/20 border border-primary-200 dark:border-primary-800 rounded-lg p-6">
        <h3 class="text-sm font-medium text-primary-700 dark:text-primary-300 uppercase tracking-wider mb-4 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          AI-генератор контента
        </h3>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1">Тема статьи</label>
            <input type="text" data-article-generator-target="topic" class="w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Например: Как использовать AI для создания контента">
          </div>

          <div>
            <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1">Стиль</label>
            <select data-article-generator-target="style" class="w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent">
              <option value="informative">Информативный</option>
              <option value="casual">Разговорный</option>
              <option value="technical">Технический</option>
              <option value="promotional">Маркетинговый</option>
            </select>
          </div>

          <button type="button" data-action="click->article-generator#generate" data-article-generator-target="generateButton" class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center justify-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <span data-article-generator-target="buttonText">Сгенерировать с AI</span>
          </button>

          <div data-article-generator-target="error" class="hidden p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-600 dark:text-red-400"></div>
        </div>
      </div>

      <!-- Content -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <%= f.label :content, "Контент", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
        <%= f.text_area :content, rows: 20, data: { article_generator_target: "content" }, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent font-mono text-sm", placeholder: "Напишите контент статьи или сгенерируйте с помощью AI..." %>
        <p class="mt-1 text-xs text-zinc-500 dark:text-zinc-400">Поддерживается Markdown форматирование</p>
      </div>

      <!-- Excerpt -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <%= f.label :excerpt, "Краткое описание", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
        <%= f.text_area :excerpt, rows: 3, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent", placeholder: "Краткое описание для превью статьи (до 500 символов)" %>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Status -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <h3 class="text-sm font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-4">Публикация</h3>
        <div class="space-y-4">
          <div>
            <%= f.label :status, "Статус", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
            <%= f.select :status, [["Черновик", "draft"], ["Опубликовано", "published"]], {}, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :published_at, "Дата публикации", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
            <%= f.datetime_local_field :published_at, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent" %>
          </div>

          <%= f.submit article.persisted? ? "Сохранить изменения" : "Создать статью", class: "w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors cursor-pointer" %>
        </div>
      </div>

      <!-- Category -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <h3 class="text-sm font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-4">Категория</h3>
        <%= f.select :category, Article::CATEGORIES.map { |c| [c.titleize, c] }, { include_blank: "Выберите категорию" }, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent" %>
      </div>

      <!-- Cover Image -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <h3 class="text-sm font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-4">Обложка</h3>
        <% if article.cover_image.attached? %>
          <div class="mb-4">
            <%= image_tag article.cover_image, class: "w-full rounded-lg" %>
          </div>
        <% end %>
        <%= f.file_field :cover_image, accept: "image/*", class: "w-full text-sm text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100 dark:file:bg-primary-900/30 dark:file:text-primary-300" %>
        <p class="mt-1 text-xs text-zinc-500 dark:text-zinc-400">JPEG, PNG, WebP. Рекомендуемый размер: 1200x630</p>
      </div>

      <!-- SEO -->
      <div class="bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6">
        <h3 class="text-sm font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-4">SEO</h3>
        <div class="space-y-4">
          <div>
            <%= f.label :meta_title, "Meta Title", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
            <%= f.text_field :meta_title, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent", placeholder: "До 70 символов" %>
          </div>

          <div>
            <%= f.label :meta_description, "Meta Description", class: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1" %>
            <%= f.text_area :meta_description, rows: 3, class: "w-full px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent", placeholder: "До 160 символов" %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
