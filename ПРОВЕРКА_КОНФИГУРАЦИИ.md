# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ ContentForce

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Gemfile)

### ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≥–µ–º—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

#### Web Framework & Server:
- ‚úÖ **rails** (8.1.2) - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- ‚úÖ **puma** (>= 5.0) - web —Å–µ—Ä–≤–µ—Ä
- ‚úÖ **thruster** - production HTTP proxy/—Å–µ—Ä–≤–µ—Ä

#### Database & Cache:
- ‚úÖ **pg** (~> 1.1) - PostgreSQL adapter
- ‚úÖ **redis** (~> 5.0) - Redis client
- ‚úÖ **solid_cache** - database-backed cache
- ‚úÖ **solid_queue** - database-backed job queue
- ‚úÖ **solid_cable** - database-backed ActionCable

#### Authentication & Authorization:
- ‚úÖ **devise** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **pundit** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞)
- ‚úÖ **omniauth-telegram** - OAuth —á–µ—Ä–µ–∑ Telegram
- ‚úÖ **bcrypt** (~> 3.1.7) - —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

#### Integrations:
- ‚úÖ **telegram-bot-ruby** - Telegram Bot API
- ‚úÖ **faraday** - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API
- ‚úÖ **faraday-retry** - retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è HTTP

#### Frontend:
- ‚úÖ **propshaft** - asset pipeline
- ‚úÖ **jsbundling-rails** - JavaScript bundling
- ‚úÖ **cssbundling-rails** - CSS bundling
- ‚úÖ **turbo-rails** - Hotwire Turbo
- ‚úÖ **stimulus-rails** - Hotwire Stimulus

#### Admin & Tools:
- ‚úÖ **administrate** - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- ‚úÖ **image_processing** (~> 1.2) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **jbuilder** - JSON API builder

#### Monitoring:
- ‚úÖ **sentry-ruby** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- ‚úÖ **sentry-rails** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sentry —Å Rails

#### Development & Testing:
- ‚úÖ **debug** - –æ—Ç–ª–∞–¥—á–∏–∫
- ‚úÖ **brakeman** - security –∞–Ω–∞–ª–∏–∑
- ‚úÖ **rubocop-rails-omakase** - code style
- ‚úÖ **rspec-rails** (~> 6.1) - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **factory_bot_rails** - —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–±—Ä–∏–∫–∏
- ‚úÖ **faker** - —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **webmock** - HTTP mocking
- ‚úÖ **vcr** - HTTP –∑–∞–ø–∏—Å—å/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ **capybara** - —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **selenium-webdriver** - –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**‚úÖ –°—Ç–∞—Ç—É—Å:** –í—Å–µ –≥–µ–º—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (`bundle check` –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ)

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Rails

### Database Configuration (config/database.yml)

‚úÖ **Production:**
```yaml
production:
  adapter: postgresql
  url: <%= ENV.fetch("DATABASE_URL") { "" } %>
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
```

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `DATABASE_URL` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç connection pooling —á–µ—Ä–µ–∑ `RAILS_MAX_THREADS`
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ Coolify

---

### Cache Configuration (config/cache.yml)

‚úÖ **Production:**
```yaml
production:
  database: cache
  max_size: 256.megabytes
  namespace: production
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** Solid Cache (database-backed cache)
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –•—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ PostgreSQL –ë–î –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

---

### Queue Configuration (config/queue.yml)

‚úÖ **Production:**
```yaml
production:
  dispatchers:
    - polling_interval: 1
      batch_size: 500
  workers:
    - queues: "*"
      threads: 3
      processes: <%= ENV.fetch("JOB_CONCURRENCY", 1) %>
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** Solid Queue (database-backed job queue)
**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ `JOB_CONCURRENCY`

---

### Cable Configuration (config/cable.yml)

‚úÖ **Production:**
```yaml
production:
  adapter: solid_cable
  connects_to:
    database:
      writing: cable
  polling_interval: 0.1.seconds
  message_retention: 1.day
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** Solid Cable (database-backed WebSocket)
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –•—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ PostgreSQL –ë–î

---

### Storage Configuration (config/storage.yml)

‚úÖ **Current:**
```yaml
local:
  service: Disk
  root: <%= Rails.root.join("storage") %>
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:**
- –î–ª—è production –≤ Coolify —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ñ–∞–π–ª—ã –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å S3 –¥–ª—è production (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```ruby
# –í config/environments/production.rb –∏–∑–º–µ–Ω–∏—Ç–µ:
config.active_storage.service = :local  # –¢–µ–∫—É—â–µ–µ
# –Ω–∞:
# config.active_storage.service = :amazon  # –î–ª—è S3
```

---

### Production Environment (config/environments/production.rb)

‚úÖ **–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

```ruby
# SSL & Security
config.assume_ssl = true
config.force_ssl = true

# Logging
config.log_tags = [:request_id]
config.logger = ActiveSupport::TaggedLogging.logger(STDOUT)
config.log_level = ENV.fetch("RAILS_LOG_LEVEL", "info")

# Cache & Jobs
config.cache_store = :solid_cache_store
config.active_job.queue_adapter = :solid_queue

# Active Storage
config.active_storage.service = :local  # ‚ö†Ô∏è –°–º. –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –≤—ã—à–µ
```

**‚úÖ –°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ production

---

### OmniAuth Configuration (config/initializers/omniauth.rb)

‚úÖ **Telegram OAuth:**
```ruby
Rails.application.config.middleware.use OmniAuth::Builder do
  provider :telegram,
           ENV.fetch('TELEGRAM_BOT_TOKEN', nil),
           origin_url: ENV.fetch('TELEGRAM_ORIGIN_URL', 'http://localhost:3001')
end
```

**–¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- `TELEGRAM_ORIGIN_URL` - URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```
20260110170553_enable_uuid_extension.rb
20260110211631_devise_create_users.rb
20260110223545_create_projects.rb
20260110223553_create_posts.rb
20260111015756_remove_confirmable_from_users.rb
20260111015912_create_telegram_bots.rb
20260111020040_add_telegram_bot_to_posts.rb
```

**–ú–æ–¥–µ–ª–∏:**
- Users (Devise authentication)
- Projects
- Posts
- TelegramBots

**‚úÖ –°—Ç–∞—Ç—É—Å:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã, –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ `bin/docker-entrypoint`

---

## üê≥ Docker Configuration

### Dockerfile

‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π multi-stage build:**

**Stage 1: Base**
- Ruby 3.4.6
- PostgreSQL client
- –ë–∞–∑–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (libvips, jemalloc)

**Stage 2: Build**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 24.12.0 + Yarn 1.22.22
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ruby gems
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node modules
- –ö–æ–º–ø–∏–ª—è—Ü–∏—è assets
- Precompile bootsnap

**Stage 3: Final**
- –¢–æ–ª—å–∫–æ runtime dependencies
- –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (rails:1000)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î —á–µ—Ä–µ–∑ entrypoint
- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Thruster + Rails server

**–ü–æ—Ä—Ç:** 3000
**–ö–æ–º–∞–Ω–¥–∞:** `./bin/thrust ./bin/rails server`

**‚úÖ –°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ production –¥–µ–ø–ª–æ—é

---

### docker-compose.yml (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

‚úÖ **–°–µ—Ä–≤–∏—Å—ã:**
- `db`: PostgreSQL 16-alpine
- `redis`: Redis 7-alpine
- `web`: Rails app (–ø–æ—Ä—Ç 3000)
- `worker`: Background jobs

**‚úÖ –°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è Production:

#### Database & Cache:
- ‚úÖ `DATABASE_URL` - PostgreSQL connection string
- ‚úÖ `REDIS_URL` - Redis connection string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redis –Ω–∞–ø—Ä—è–º—É—é)

#### Rails Configuration:
- ‚úÖ `RAILS_ENV=production`
- ‚úÖ `RAILS_MAX_THREADS=5`
- ‚úÖ `WEB_CONCURRENCY=2`
- ‚úÖ `RAILS_SERVE_STATIC_FILES=true`
- ‚úÖ `RAILS_LOG_TO_STDOUT=true`

#### Security:
- ‚úÖ `RAILS_MASTER_KEY` - –∫–ª—é—á –∏–∑ config/master.key
- ‚úÖ `SECRET_KEY_BASE` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `rails secret`

#### Telegram:
- ‚úÖ `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- ‚úÖ `TELEGRAM_BOT_USERNAME` - username –±–æ—Ç–∞
- ‚úÖ `TELEGRAM_ORIGIN_URL` - URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### OpenRouter AI:
- ‚úÖ `OPENROUTER_API_KEY` - API –∫–ª—é—á
- ‚úÖ `OPENROUTER_API_URL=https://openrouter.ai/api/v1`
- ‚úÖ `OPENROUTER_SITE_URL` - URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ `OPENROUTER_SITE_NAME=ContentForce`

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

#### AWS S3 (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ):
- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `AWS_REGION`
- `AWS_BUCKET`

#### Sentry:
- `SENTRY_DSN`

#### Robokassa:
- `ROBOKASSA_MERCHANT_LOGIN`
- `ROBOKASSA_PASSWORD_1`
- `ROBOKASSA_PASSWORD_2`

#### Performance:
- `JOB_CONCURRENCY=1` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ worker –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- `RAILS_LOG_LEVEL=info` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –¥–ª—è Coolify

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
–í—Å–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ **"Runtime Only"** –≤ Coolify:
- `DATABASE_URL`
- `REDIS_URL`
- `RAILS_MASTER_KEY`
- `SECRET_KEY_BASE`
- `TELEGRAM_BOT_TOKEN`
- `OPENROUTER_API_KEY`

**–ü–æ—á–µ–º—É?** –ï—Å–ª–∏ –æ–Ω–∏ –±—É–¥—É—Ç "Build Time", —Ç–æ –ø–æ–ø–∞–¥—É—Ç –≤ Docker image –∏ —Å–æ–∑–¥–∞–¥—É—Ç –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**Solid Cache, Solid Queue, Solid Cable** –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–¢–£ –ñ–ï PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- ‚úÖ –ù—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –û–î–ù–ê PostgreSQL —Å–ª—É–∂–±–∞ –≤ Coolify
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–¥—É—Ç –Ω—É–∂–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–∞–∑—ã –¥–ª—è cache/queue/cable

**–¢–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:**
- `solid_cache_entries` - –¥–ª—è cache
- `solid_queue_*` - –¥–ª—è job queue (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü)
- `solid_cable_messages` - –¥–ª—è WebSocket

---

### 3. Redis

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –í —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Redis **–ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø** –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- ‚ùå Cache - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Solid Cache (PostgreSQL)
- ‚ùå Jobs - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Solid Queue (PostgreSQL)
- ‚ùå Cable - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Solid Cable (PostgreSQL)

**–ï—Å–ª–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Redis –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–¥–µ:**
- –ú–æ–∂–µ—Ç–µ –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å Redis —Å–µ—Ä–≤–∏—Å –≤ Coolify
- –ú–æ–∂–µ—Ç–µ –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `REDIS_URL`

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Redis –≤ –∫–æ–¥–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `app/` –ø–∞–ø–∫—É):**
- –°–æ–∑–¥–∞–π—Ç–µ Redis 7 —Å–µ—Ä–≤–∏—Å –≤ Coolify
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `REDIS_URL`

---

### 4. –ü–æ—Ä—Ç—ã

**Dockerfile expose:** 3000
**Coolify Container Port:** 3000
**Coolify Public Port:** 80 –∏–ª–∏ 443 (—Å SSL)

**‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

### 5. –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** Local storage –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ç–µ—Ä—è—é—Ç—Å—è!

**–†–µ—à–µ–Ω–∏—è:**

**–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):** AWS S3
1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ü–∏—é S3 –≤ `config/storage.yml`
2. –ò–∑–º–µ–Ω–∏—Ç–µ `config.active_storage.service = :amazon` –≤ production.rb
3. –î–æ–±–∞–≤—å—Ç–µ AWS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç 2:** Coolify Persistent Volume
1. –í Coolify ‚Üí Application ‚Üí Storage
2. –î–æ–±–∞–≤—å—Ç–µ volume: `/rails/storage` ‚Üí mount –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
3. –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏

---

### 6. SSL/HTTPS

**–í production.rb:**
```ruby
config.force_ssl = true
```

**–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:** Rails –æ–∂–∏–¥–∞–µ—Ç HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

**–í Coolify:**
- ‚úÖ –í–∫–ª—é—á–∏—Ç–µ SSL —á–µ—Ä–µ–∑ Let's Encrypt
- ‚úÖ Coolify –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç SSL termination
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ HTTPS proxy

---

### 7. –î–æ–º–µ–Ω –¥–ª—è Telegram

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û**:

1. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º:
   - `TELEGRAM_ORIGIN_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com`
   - `OPENROUTER_SITE_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com`

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram Webhook:
```bash
# –í Coolify Terminal:
./bin/rails console

# –í –∫–æ–Ω—Å–æ–ª–∏ Rails:
bot = Telegram::Bot::Client.new(ENV['TELEGRAM_BOT_TOKEN'])
bot.set_webhook(url: "#{ENV['TELEGRAM_ORIGIN_URL']}/telegram/webhook")
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

- [x] –í—Å–µ –≥–µ–º—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (bundle check OK)
- [x] Dockerfile –≥–æ—Ç–æ–≤ –∫ production
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –≥–æ—Ç–æ–≤—ã
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è production –≥–æ—Ç–æ–≤–∞
- [x] –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω Solid Cache/Queue/Cable (—á–µ—Ä–µ–∑ PostgreSQL)

### –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Coolify:

- [ ] PostgreSQL 16 —Å–µ—Ä–≤–∏—Å
- [ ] Redis 7 —Å–µ—Ä–≤–∏—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] Application –∏–∑ GitHub
- [ ] Environment Variables (Runtime Only!)
- [ ] Port 3000 ‚Üí 80/443
- [ ] Domain + SSL
- [ ] Persistent storage (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Ñ–∞–π–ª—ã) –∏–ª–∏ S3

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/up` health endpoint
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram Webhook
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–∞–¥–º–∏–Ω–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

---

## üìù –ó–∞–º–µ—Ç–∫–∏

### Solid* –≥–µ–º—ã (Cache/Queue/Cable)

–≠—Ç–∏ –≥–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç PostgreSQL –≤–º–µ—Å—Ç–æ Redis –¥–ª—è:
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–Ω–µ –Ω—É–∂–µ–Ω Redis)
- ‚úÖ –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–æ–¥–Ω–∞ –ë–î –¥–ª—è –≤—Å–µ–≥–æ)
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å (transactional)

**–ú–∏–Ω—É—Å:** –ù–µ–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ Redis, –Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

### Thruster

Production HTTP server, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –û–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ö–µ—à–∏—Ä—É–µ—Ç assets
- ‚úÖ –°–∂–∏–º–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã (gzip/brotli)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è Rails

**–†–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ–¥ Puma** –∫–∞–∫ reverse proxy.

---

**–í—Å–µ –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é! üöÄ**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–î–ï–ü–õ–û–Ø.md` –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –¥–µ–ø–ª–æ—è.
